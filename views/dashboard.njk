{% extends "layout.njk" %}

{% block extra_css %}
<link rel="stylesheet" href="/css/pages/dashboard.css">
<link rel="stylesheet" href="/css/components/charts.css">
<link rel="stylesheet" href="/css/components/alerts.css">
{% endblock %}

{% block content %}
<div class="container-fluid p-4">
  
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1><i class="bi bi-speedometer2 me-2"></i>Dashboard</h1>
      <p class="text-muted mb-0">Dashboard Overview</p>
    </div>
    <div class="text-end">
      <button class="btn btn-outline-primary btn-sm" id="refreshBtn">
        <i class="bi bi-arrow-clockwise me-1"></i> Refresh
      </button>
      <small class="text-muted d-block mt-2">
        Last updated: <span id="lastUpdate">--:--:--</span>
      </small>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="row g-3 mb-4">
    
    <!-- Total NVRs -->
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="text-muted mb-2">TOTAL NVRS</h6>
              <h2 class="mb-0" id="totalNVRs">0</h2>
              <small class="text-muted" id="totalNVRsChange"></small>
            </div>
            <div class="stat-icon bg-primary"><i class="bi bi-hdd-rack"></i></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Total Cameras -->
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="text-muted mb-2">TOTAL CAMERAS</h6>
              <h2 class="mb-0" id="totalCameras">0</h2>
              <small class="text-muted" id="totalCamerasChange"></small>
            </div>
            <div class="stat-icon bg-success"><i class="bi bi-camera-video"></i></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Offline NVRs -->
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="text-muted mb-2">OFFLINE NVRS</h6>
              <h2 class="mb-0" id="offlineNVRs">0</h2>
              <small class="text-muted" id="offlineNVRsChange"></small>
            </div>
            <div class="stat-icon bg-danger"><i class="bi bi-hdd-rack-fill"></i></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Offline Cameras -->
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="text-muted mb-2">OFFLINE CAMERAS</h6>
              <h2 class="mb-0" id="offlineCameras">0</h2>
              <small class="text-muted" id="offlineCamerasChange"></small>
            </div>
            <div class="stat-icon bg-warning"><i class="bi bi-camera-video-off"></i></div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Charts Section -->
  <div class="row g-3 mb-4">
    <div class="col-12 mb-2">
      <h5><i class="bi bi-bar-chart me-2"></i>System Analytics</h5>
    </div>

    <!-- System Health -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-header"><h6 class="mb-0"><i class="bi bi-heart-pulse"></i> System Health</h6></div>
        <div class="card-body">
          <div id="systemHealthChart" style="height: 250px;"></div>
        </div>
      </div>
    </div>

    <!-- Camera Status Trend -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-header"><h6 class="mb-0"><i class="bi bi-camera"></i> Camera Status Trends</h6></div>
        <div class="card-body">
          <div id="cameraStatusChart" style="height: 250px;"></div>
        </div>
      </div>
    </div>

    <!-- NVR Status Trend -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-header"><h6 class="mb-0"><i class="bi bi-hdd"></i> NVR Status Trends</h6></div>
        <div class="card-body">
          <div id="nvrStatusChart" style="height: 250px;"></div>
        </div>
      </div>
    </div>

    <!-- Storage Trend -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-header"><h6 class="mb-0"><i class="bi bi-database"></i> Storage Trends</h6></div>
        <div class="card-body">
          <div id="storageTrendChart" style="height: 250px;"></div>
        </div>
      </div>
    </div>

  </div>

  <!-- Recent Alerts & System Summary -->
  <div class="row g-3 mb-4">
    
    <!-- Recent Alerts -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="bi bi-bell me-2"></i>Recent Alerts</h5>
        </div>
        <div class="card-body p-0">
          <div id="recentAlerts"></div>
        </div>
      </div>
    </div>

    <!-- System Summary -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>System Summary</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6 mb-3">
              <h3 class="text-primary" id="summaryRegions">0</h3>
              <small class="text-muted">Regions</small>
            </div>
            <div class="col-6 mb-3">
              <h3 class="text-success" id="summaryBranches">0</h3>
              <small class="text-muted">Branches</small>
            </div>
            <div class="col-6">
              <h3 class="text-warning" id="summaryStorage">0</h3>
              <small class="text-muted">Storage Used</small>
            </div>
            <div class="col-6">
              <h3 class="text-info" id="summaryUptime">0</h3>
              <small class="text-muted">System Uptime</small>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Regional Distribution -->
  <div class="row g-3">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="bi bi-geo-alt me-2"></i>Regional Distribution</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead>
                <tr>
                  <th>Region</th>
                  <th>NVRs</th>
                  <th>Cameras</th>
                  <th>Online</th>
                  <th>Offline</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="regionalBreakdown"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="/js/pages/dashboard.js"></script>
{% endblock %}
